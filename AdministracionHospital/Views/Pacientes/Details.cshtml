@model IEnumerable<AdministracionHospital.Models.HistorialPacienteModel>

@{
    ViewBag.Title = "Historial Médico";
    Layout = "~/Views/Shared/_Layout.cshtml"; 
}

<div class="container-fluid">
    <h2 class="text-justify"><strong>Historial Médico del Paciente</strong></h2>
    <hr />

    @using (Html.BeginForm("Details", "Pacientes", FormMethod.Get))
    {
        <div class="row mb-3">
            <div class="col-md-4">
                <label for="ID_Paciente" class="form-label">Cédula:</label>
                <input type="text" name="ID_Paciente" id="ID_Paciente"
                       class="form-control" placeholder="Formato: x-xxxx-xxxx"
                       value="@ViewBag.ID_PacienteActual" required />
            </div>
            <div class="col-md-8 d-flex align-items-end">
                <button type="submit" class="btn btn-primary me-2">
                    <i class="fas fa-search"></i> Consulta
                </button>
                @Html.ActionLink("Volver al Inicio", "Index", "Home", null, new { @class = "btn btn-danger" })
            </div>
        </div>
    }

    <hr />

    @if (Model != null && Model.Any())
    {
        <h3 class="bg-primary text-center p-4"><strong>Historial para el Paciente</strong></h3>
        <h4>@Model.First().Paciente | <strong>Cedula:</strong> @Model.First().Cedula_Paciente</h4>

        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Fecha Cita</th>
                    <th>Diagnóstico</th>
                    <th>Medicamento</th>
                    <th>Dosis</th>
                    <th>Indicaciones</th>
                    <th>Cantidad de Medicamentos</th>
                    <th>Costo Total Tratamientos</th>
                    <th>Hospital</th>
                    <th>Atendido Por</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@Html.DisplayFor(modelItem => item.Fecha_Cita)</td>
                        <td>@Html.DisplayFor(modelItem => item.Diagnostico)</td>
                        <td>@Html.DisplayFor(modelItem => item.Medicamento)</td>
                        <td>@Html.DisplayFor(modelItem => item.Dosis)</td>
                        <td>@Html.DisplayFor(modelItem => item.Indicaciones)</td>
                        <td class="text-center">@Html.DisplayFor(modelItem => item.Cantidad_Medicamentos)</td>
                        <td>@Html.DisplayFor(modelItem => item.Costo_Total_Tratamiento)</td>
                        <td>@Html.DisplayFor(modelItem => item.Hospital)</td>
                        <td>@Html.DisplayFor(modelItem => item.Atendido_Por)</td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else if (ViewBag.ID_PacienteActual != null)
    {
        <div class="alert alert-warning">
            No se encontraron registros de historial médico para la cédula: **@ViewBag.ID_PacienteActual**.
        </div>
    }
</div>